<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>FedSGD - AI Pocket Reference: FL</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A streamlined reference manual for AI practitioners, students, and developers to quickly look up core concepts and mock implementations">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../_common/mdbook-ai-pocket-reference.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AI Pocket Reference: FL</h1>

                    <div class="right-buttons">
                        <a href="https://vectorinstitute.github.io/ai-pocket-reference/" title="Home" aria-label="Home">
                            <i id="home-button" class="fa fa-home"></i>
                        </a>
                        <a href="https://github.com/VectorInstitute/ai-pocket-reference" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- markdownlint-disable-file MD033 MD013 -->
<h1 id="fedsgd"><a class="header" href="#fedsgd">FedSGD</a></h1>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2em;">
  <div>
    <a target="_blank" href="https://github.com/VectorInstitute/ai-pocket-reference/issues/new?template=edit-request.yml">
      <img src="https://img.shields.io/badge/Suggest_an_Edit-black?logo=github&style=flat" alt="Suggest an Edit"/>
    </a>
    <p style="margin: 0;"><small>Reading time: 4 min</small></p>
  </div>
</div>
<p>Given the Horizontal FL setup, the general idea of FedSGD<sup class="footnote-reference"><a href="#1">1</a></sup> is fairly
straightforward.</p>
<ol>
<li>During each server round, participating clients compute a gradient based on
their local loss function, using the current model weights, \(\mathbf{w}\),
applied to their local dataset. These gradients are sent to the server.</li>
<li>The server uses the client gradients to update the weights of a model.</li>
<li>The server sends the updated model weights back to the clients, who proceed
to compute a new gradient based on their data.</li>
</ol>
<h2 id="the-math"><a class="header" href="#the-math">The math</a></h2>
<p>Leveraging the notation set out in the previous section
(<a href="index.html">Foundational FL Techniques</a>), denote by \(P_k\) the indices
of samples from client \(k\) in the total dataset \(D\), and denote
\(n_k = \vert P_k \vert\). Then we can write the loss over the entire
dataset as</p>
<p>$$
\begin{align*}
\ell(\mathbf{w}) = \frac{1}{n} \sum_{k=1}^{N} \sum_{i \in P_k} \ell_i(\mathbf{w}),
\end{align*}
$$</p>
<p>recalling that \(\ell_i(\mathbf{w})\) is the loss function with respect
to the \(i^{\text{th}}\) sample. In this equation it is the
\(i^{\text{th}}\) sample drawn from the dataset \(D_k\).</p>
<p>For a server round \(t\) and current set of model weights, \(\mathbf{w}_t\),
consider selected a subset, \(C_t\), of \(m \leq N\) clients from which to
compute a weight update. The loss over all data points held by the clients in
\(C_t\) is written</p>
<p>$$
\begin{align*}
\ell_t(\mathbf{w}_t) = \frac{1}{n_s} \sum_{k \in C_t} \sum_{i \in P_k} \ell_i(\mathbf{w}_t),
\end{align*}
$$</p>
<p>where \(n_s = \displaystyle{\sum_{k \in C_t} n_k}\). For a given client
\(k\), define</p>
<p>$$
\begin{align*}
L_k(\mathbf{w_t}) = \frac{1}{n_k} \sum_{i \in P_k} \ell_i(\mathbf{w_t}).
\end{align*}
$$</p>
<p>Note that \(L_k(\mathbf{w}_t)\) is simply the local loss for client \(k\) across all
data points in its dataset, \(D_k\). Then</p>
<p>$$
\begin{align*}
\ell_t(\mathbf{w}_t) = \sum_{k \in C_t} \frac{n_k}{n_s} L_k(\mathbf{w}_t).
\end{align*}
$$</p>
<p>Observe that the global loss, \(\ell_t(\mathbf{w}_t)\), over the selected
subset of clients, \(C_t\), is now written as a linearly weighted combination
of the local losses of each client.</p>
<p>As the gradient is a linear operator, the gradient of the global loss is</p>
<p>$$
\begin{align*}
\nabla \ell_t(\mathbf{w}_t) = \sum_{k \in C_t} \frac{n_k}{n_s} \nabla L_k(\mathbf{w}_t).
\end{align*}
$$</p>
<p>This implies that model weights \(\mathbf{w}_t\) are updated as</p>
<p>$$
\begin{align}
\mathbf{w}_{t+1} = \mathbf{w}_t - \eta \sum_{k \in C_t} \frac{n_k}{n_s} \nabla L_k(\mathbf{w}_t), \tag{1}
\end{align}
$$</p>
<p>for some learning rate \(\eta &gt; 0\). Because \(\nabla L_k(\mathbf{w}_t)\)
is the gradient of the local loss function of client \(k\), this update is
simply a linearly weighted combination of <strong>local</strong> gradients, which can be
computed locally by each client.</p>
<h3 id="fedsgd-is-just-large-batch-sgd"><a class="header" href="#fedsgd-is-just-large-batch-sgd">FedSGD is just Large Batch SGD</a></h3>
<p>One of the important properties of FedSGD is that the update in Equation (1) is
mathematically equivalent to</p>
<p>$$
\begin{align*}
\mathbf{w}_{t+1} = \mathbf{w}_t - \eta \nabla \ell_t(\mathbf{w}_t),
\end{align*}
$$</p>
<p>where \(\ell_t\) denotes the loss function over all data in each of the
clients in \(C_t\). As such, FedSGD, in spite of leveraging gradients
computed in a distributed fashion on each individual client, is equivalent to
performing centralized batch SGD, where the batch is of size
\(n_s = \displaystyle{\sum_{k \in C_t} n_k}\).</p>
<p>Among other implications, this means that convergence theory associated with
standard batch SGD is directly applicable to the FedSGD procedure.</p>
<h2 id="the-algorithm"><a class="header" href="#the-algorithm">The algorithm</a></h2>
<p>We are now in a position to fill in the details of the general Horizontal FL algorithm
presented in <a href="../index.html">Horizontal Federated Learning</a>. The full workflow
of FedSGD is summarized in the algorithm below. Inputs are \(N\),
the number of clients, \(T\), the number of server rounds to perform,
\(\eta\) the learning rate, and \(\mathbf{w}\), the initial weights for
the model to be trained. After the final server round is complete, each
client receives the final model as described by the weights \(\mathbf{w}_T\).</p>
<figure>
<center>
<img src="https://d3ddy8balm3goa.cloudfront.net/vector-ai-pocket-refs/fl/algorithm-fedsgd.svg" alt="FedSGD Algorithm">
</center>
</figure>
<h3 id="communication-overhead"><a class="header" href="#communication-overhead">Communication overhead</a></h3>
<p>The FedSGD algorithm has several benefits, including the mathematical
equivalence discussed above. However, it has at least one significant drawback.
Communication between the clients and server occurs for every SGD step. That
is, for each model update, participating clients are required to communicate their
gradients, and the server must send updated model weights back. In most settings,
latency associated with communication between clients and servers will be
significantly higher than that of computing the local gradients or performing
the weight updates. As such communication overhead become a significant
bottleneck and materially slows training. Reducing communication costs is the
driving motivation behind the FedAvg approach.</p>
<h4 id="references--useful-links"><a class="header" href="#references--useful-links">References &amp; Useful Links</a></h4>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://proceedings.mlr.press/v54/mcmahan17a/mcmahan17a.pdf" target="_blank" rel="noopener noreferrer">H. B. McMahan, E. Moore, D. Ramage, S. Hampson, and B. A. y Arcas.
Communication-efficient learning of deep networks from decentralized data.
Proceedings of the 20th AISTATS, 2017.</a></p>
</div>
<hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
<div class="contributor-footnotes">
<small>
<strong>Contributors:</strong>
<div style="display: flex; gap: 8px; margin-top: 10px;">
<a href="https://github.com/emersodb">
<img src="https://github.com/emersodb.png"
  width="32px" alt="Contributor emersodb" style="border-radius: 50%">
</a>
</div>
</small>
</div>
<div class="vector-logo">
    <a href="https://vectorinstitute.ai/">
        <img src="https://d3ddy8balm3goa.cloudfront.net/vector-ai-pocket-refs/vector-logo-default.png" alt="" class="light-logo">
    </a>
    <a href="https://vectorinstitute.ai/">
        <img src="https://d3ddy8balm3goa.cloudfront.net/vector-ai-pocket-refs/vector-logo-dark.png" alt="" class="dark-logo">
    </a>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../horizontal/vanilla_fl/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../horizontal/vanilla_fl/fedavg.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../horizontal/vanilla_fl/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../horizontal/vanilla_fl/fedavg.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
